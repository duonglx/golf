<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOB Year-End Outing 2025 - Pairing System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #f0fdf4; }
        .font-mono-tech { font-family: 'Share Tech Mono', monospace; }

        /* Background Pattern */
        .bg-golf {
            background-color: #064e3b;
            background-image: radial-gradient(#065f46 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Card Styles */
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .card-hover:hover { transform: translateY(-3px); box-shadow: 0 15px 20px -5px rgba(0, 0, 0, 0.15); transition: all 0.3s ease; }
        .badge-hdc { background-color: #dcfce7; color: #166534; border: 1px solid #86efac; }

        /* --- MAGIC HUD ANIMATION STYLES --- */
        #magic-overlay {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
        }
        
        .hud-circle {
            position: relative;
            width: 250px;
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(16, 185, 129, 0.1) 0%, rgba(0,0,0,0) 70%);
        }

        /* Vòng xoay bên ngoài */
        .hud-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid transparent;
            border-top-color: #34d399; /* Green 400 */
            border-right-color: #10b981; /* Green 500 */
            animation: spin-right 2s linear infinite;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
        }

        .hud-ring::before {
            content: '';
            position: absolute;
            top: 10px; left: 10px; right: 10px; bottom: 10px;
            border-radius: 50%;
            border: 2px solid transparent;
            border-bottom-color: #fbbf24; /* Amber 400 */
            border-left-color: #f59e0b; /* Amber 500 */
            animation: spin-left 3s linear infinite;
        }

        @keyframes spin-right { 100% { transform: rotate(360deg); } }
        @keyframes spin-left { 100% { transform: rotate(-360deg); } }

        /* Hiệu ứng chữ chạy */
        .decipher-text {
            font-family: 'Share Tech Mono', monospace;
            text-shadow: 0 0 10px rgba(52, 211, 153, 0.8);
        }

        /* Modal Animation */
        .modal-enter { animation: modalIn 0.3s ease-out forwards; }
        .modal-leave { animation: modalOut 0.2s ease-in forwards; }
        
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        @keyframes modalOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col text-slate-800 bg-gray-50">

    <div id="magic-overlay" class="hidden fixed inset-0 z-[100] flex flex-col items-center justify-center text-white overflow-hidden">
        <div class="absolute inset-0 opacity-20" style="background-image: linear-gradient(#34d399 1px, transparent 1px), linear-gradient(90deg, #34d399 1px, transparent 1px); background-size: 40px 40px;"></div>
        
        <div class="relative z-10 flex flex-col items-center">
            <div class="hud-circle mb-8">
                <div class="hud-ring"></div>
                <i class="fa-solid fa-microchip text-5xl text-green-400 animate-pulse"></i>
            </div>

            <div class="text-center space-y-2">
                <p class="text-green-400 text-xs font-mono-tech tracking-[0.2em] uppercase">System Processing</p>
                <h2 id="magic-name" class="text-3xl md:text-5xl font-bold text-white decipher-text min-h-[60px]">INITIALIZING...</h2>
                <p id="magic-status" class="text-gray-400 text-sm font-mono-tech">Loading algorithms...</p>
            </div>

            <div class="w-80 h-1 bg-gray-800 mt-8 rounded-full overflow-hidden relative border border-gray-700">
                <div id="magic-progress" class="h-full bg-gradient-to-r from-green-400 to-emerald-600 w-0 shadow-[0_0_10px_rgba(52,211,153,0.8)]"></div>
            </div>
            
            <div class="mt-4 flex gap-2">
                <div class="w-1 h-4 bg-green-500 animate-bounce" style="animation-delay: 0.1s"></div>
                <div class="w-1 h-6 bg-green-500 animate-bounce" style="animation-delay: 0.3s"></div>
                <div class="w-1 h-3 bg-green-500 animate-bounce" style="animation-delay: 0.2s"></div>
                <div class="w-1 h-8 bg-green-500 animate-bounce" style="animation-delay: 0.5s"></div>
                <div class="w-1 h-5 bg-green-500 animate-bounce" style="animation-delay: 0.4s"></div>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="hidden fixed inset-0 z-[90] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md relative z-10 overflow-hidden modal-enter border border-gray-100">
            <div class="bg-slate-50 px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                    <i class="fa-solid fa-shuffle text-blue-600"></i> Xác nhận chia nhóm
                </h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
            <div class="p-6">
                <div class="flex items-start gap-4">
                    <div class="bg-blue-100 p-3 rounded-full flex-shrink-0">
                        <i class="fa-solid fa-triangle-exclamation text-blue-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-slate-600 text-sm leading-relaxed">
                            Bạn có chắc chắn muốn xóa kết quả hiện tại và thực hiện <b>quay ngẫu nhiên</b> lại từ đầu không?
                        </p>
                        <p class="text-xs text-slate-400 mt-2 bg-slate-50 p-2 rounded border border-slate-100">
                            <i class="fa-solid fa-circle-info mr-1"></i> Dữ liệu cũ sẽ bị thay thế hoàn toàn.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="bg-gray-50 px-6 py-4 flex justify-end gap-3 border-t border-gray-100">
                <button onclick="closeModal()" class="px-5 py-2.5 rounded-lg text-sm font-semibold text-gray-600 hover:bg-gray-200 transition border border-gray-300">
                    Hủy bỏ
                </button>
                <button onclick="confirmReshuffle()" class="px-5 py-2.5 rounded-lg text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-600/30 transition flex items-center gap-2">
                    <i class="fa-solid fa-play"></i> Bắt đầu quay
                </button>
            </div>
        </div>
    </div>

    <header class="bg-golf text-white relative shadow-2xl overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-black/60 to-transparent"></div>
        <div class="container mx-auto px-4 py-8 relative z-10">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="flex items-center gap-4">
                    <div class="bg-white/10 p-3 rounded-full backdrop-blur-sm border border-white/20 shadow-[0_0_15px_rgba(255,255,255,0.3)]">
                        <i class="fa-solid fa-golf-ball-tee text-4xl text-yellow-400"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-extrabold text-white tracking-tight text-yellow-400 drop-shadow-lg">OUTING CUỐI NĂM WOB</h1>
                        <p class="text-white/90 text-sm md:text-base font-medium mt-1 font-mono-tech"><i class="fa-solid fa-calendar-day mr-2 text-green-400"></i>28/11/2025 | Sân Đông - Thủ Đức</p>
                    </div>
                </div>

                <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/10 text-sm min-w-[280px] shadow-lg">
                    <div class="flex justify-between items-center border-b border-white/10 pb-2 mb-2">
                        <span class="text-gray-300">Tổng người chơi</span>
                        <span class="font-bold text-xl text-green-400">32</span>
                    </div>
                    <div class="flex items-center gap-2 text-yellow-300">
                        <i class="fa-solid fa-clock w-5"></i>
                        <span class="font-mono-tech text-lg">06:37 - 07:26</span>
                    </div>
                </div>
            </div>

            <div class="mt-8 flex flex-wrap gap-3 border-t border-white/10 pt-4">
                <button onclick="copyToClipboard()" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2.5 px-6 rounded-lg shadow-lg shadow-emerald-500/30 transition flex items-center gap-2 transform hover:-translate-y-0.5">
                    <i class="fa-regular fa-copy"></i> Copy Excel
                </button>
                <div class="flex-grow"></div>
                <button onclick="openModal()" class="bg-white text-red-600 hover:bg-red-50 font-bold py-2.5 px-6 rounded-lg shadow-lg transition flex items-center gap-2 transform hover:-translate-y-0.5 border border-red-100">
                    <i class="fa-solid fa-arrows-rotate"></i> Chia Lại
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 -mt-6 relative z-20">
        <div id="fly-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
    </main>

    <footer class="bg-slate-900 text-slate-500 py-8 text-center text-xs border-t border-slate-800">
        <p class="font-mono-tech">POWERED BY WOB GOLF TECH SYSTEM v2.5</p>
    </footer>

    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl z-50 transition-all duration-300 opacity-0 translate-y-10 flex items-center gap-3">
        <i class="fa-solid fa-circle-check text-green-400"></i>
        <span id="toast-msg">Thông báo hệ thống</span>
    </div>

    <script>
        const CONFIG = {
            startDate: "28/11/2025",
            startTime: "06:37", 
            interval: 7,        
            storageKey: "WOB_OUTING_FINAL_MAGIC_V2", 
            totalPlayers: 32
        };

        // Dữ liệu người chơi MỚI (32 người - đã cập nhật)
        const playersDB = [
            { name: "Lê Hoàng Hải", vga: "888838", hdc: 28, avatar: "1" },
            { name: "Lê Xuân Dương", vga: "50334", hdc: 29, avatar: "2" },
            { name: "Lê Hồng Sơn", vga: "68539", hdc: 18, avatar: "3" },
            { name: "Trần Thành Nam", vga: "100659", hdc: 22, avatar: "4" },
            { name: "Trần Thanh Bảo (Dự bị)", vga: "46389", hdc: 36, avatar: "5" },
            { name: "Ngô Thanh Tân", vga: "147157", hdc: 28, avatar: "6" },
            { name: "Phạm Hữu Nghĩa", vga: "103058", hdc: 39, avatar: "7" },
            { name: "Phan Công Tú", vga: "83376", hdc: 28, avatar: "8" },
            { name: "Vũ Duy Kiên", vga: "32965", hdc: 27, avatar: "9" },
            { name: "Hàn Quốc Ân", vga: "888646", hdc: 24, avatar: "10" },
            { name: "Trần Quang Khánh", vga: "53612", hdc: 16, avatar: "11" },
            { name: "Nguyễn Quốc Khánh", vga: "888789", hdc: 21, avatar: "12" },
            { name: "Nguyễn Văn Phương (b.Nam)", vga: "94320", hdc: 23, avatar: "13" },
            { name: "Bùi Thế Lam", vga: "888468", hdc: 24, avatar: "14" },
            { name: "Võ Thành Bảo", vga: "888668", hdc: 23, avatar: "15" },
            { name: "Lê Thế Tào (bạn Ân)", vga: "75033", hdc: 27, avatar: "16" },
            { name: "Trần Nguyễn Tấn Cường", vga: "95171", hdc: 27, avatar: "17" },
            { name: "Bùi Đức Tùng (bạn Nam)", vga: "47824", hdc: 21, avatar: "18" },
            { name: "Võ Tấn Khương", vga: "150473", hdc: 28, avatar: "19" },
            { name: "Nguyễn Hà Tuấn", vga: "90203", hdc: 30, avatar: "20" },
            { name: "Nguyễn Hoài Thanh", vga: "40593", hdc: 26, avatar: "21" },
            { name: "Phạm Xuân Cảnh", vga: "52344", hdc: 20, avatar: "22" },
            { name: "Huỳnh Công Lĩnh", vga: "888222", hdc: 17, avatar: "23" },
            { name: "Bùi Tiến Bảo", vga: "888828", hdc: 29, avatar: "24" },
            { name: "Nguyễn Quang Huy", vga: "888333", hdc: 16, avatar: "25" },
            { name: "Đặng Thế Cường", vga: "19899", hdc: 7, avatar: "26" },
            { name: "Nguyễn Long Giao", vga: "4722", hdc: 20, avatar: "27" },
            { name: "Trần Thanh Tú", vga: "888588", hdc: 22, avatar: "28" },
            { name: "Hoàng Anh Tiến", vga: "114019", hdc: 17, avatar: "29" },
            { name: "Bùi Hoàng Bi", vga: "158758", hdc: 21, avatar: "30" },
            { name: "Nguyễn Hoàng Việt", vga: "53224", hdc: 40, avatar: "31" },
            { name: "Trịnh Quốc Dân An", vga: "56320", hdc: 28, avatar: "32" }
        ];

        let currentFlights = [];

        // --- INIT ---
        function init() {
            const savedData = localStorage.getItem(CONFIG.storageKey);
            if (savedData) {
                currentFlights = JSON.parse(savedData);
                renderFlights();
            } else {
                openModal(); // Lần đầu vào thì hỏi luôn
            }
        }

        // --- MODAL LOGIC ---
        function openModal() {
            document.getElementById('confirm-modal').classList.remove('hidden');
        }
        function closeModal() {
            document.getElementById('confirm-modal').classList.add('hidden');
        }
        function confirmReshuffle() {
            closeModal();
            startMagicSequence();
        }

        // --- MAGIC ANIMATION LOGIC ---
        function startMagicSequence() {
            const overlay = document.getElementById('magic-overlay');
            const magicName = document.getElementById('magic-name');
            const magicStatus = document.getElementById('magic-status');
            const progressBar = document.getElementById('magic-progress');
            const grid = document.getElementById('fly-grid');
            
            // Reset
            overlay.classList.remove('hidden');
            grid.innerHTML = ''; 
            localStorage.removeItem(CONFIG.storageKey);
            progressBar.style.width = '0%';
            
            const totalDuration = 5000; 
            const steps = 100;
            let currentStep = 0;
            
            // Text Decipher Loop
            const decipherInterval = setInterval(() => {
                const randomPlayer = playersDB[Math.floor(Math.random() * playersDB.length)];
                magicName.innerText = randomPlayer.name.toUpperCase();
                
                // Cập nhật trạng thái text giả lập
                if(currentStep < 20) magicStatus.innerText = "Analyzing HCP Database...";
                else if(currentStep < 50) magicStatus.innerText = "Optimizing Pairing Algorithms...";
                else if(currentStep < 80) magicStatus.innerText = "Shuffling Seed: " + Math.random().toString(36).substring(7).toUpperCase();
                else magicStatus.innerText = "Finalizing Flights...";

                currentStep++;
            }, 50); // Đổi tên mỗi 50ms

            // Progress Bar Animation
            setTimeout(() => { progressBar.style.width = '100%'; progressBar.style.transition = 'width 5s linear'; }, 100);

            // Kết thúc
            setTimeout(() => {
                clearInterval(decipherInterval);
                magicName.innerText = "COMPLETED";
                magicStatus.innerText = "Access Granted.";
                
                // Tạo dữ liệu thật
                generateFlights();
                
                // Ẩn Overlay
                setTimeout(() => {
                    overlay.classList.add('hidden');
                }, 800);
            }, totalDuration);
        }

        // --- CORE LOGIC (GENERATOR) ---
        function generateFlights() {
            let pool = shuffle([...playersDB]);
            const groupStructure = Array(8).fill(4); 
            currentFlights = [];
            let playerIndex = 0;

            // AVATAR PARAMS (V9 Fixed)
            const maleHairStyles = [ "shortCurly", "shortDreads1", "shortDreads2", "shortFlat", "shortRound", "shortWaved", "sides", "theCaesar", "theCaesarSidePart" ];
            const maleStyleParams = maleHairStyles.map(s => `top[]=${s}`).join('&') + "&facialHairProbability=50";

            groupStructure.forEach((size, index) => {
                let members = [];
                let totalHDC = 0;
                for(let i=0; i<size; i++) {
                    if (playerIndex < pool.length) {
                        let p = pool[playerIndex];
                        p.avatarUrl = `https://api.dicebear.com/9.x/avataaars/svg?seed=WOB_${p.avatar}&${maleStyleParams}&backgroundColor=c0aede,b6e3f4,c0aede`;
                        members.push(p);
                        totalHDC += (p.hdc || 0);
                        playerIndex++;
                    }
                }
                currentFlights.push({
                    flyNo: index + 1,
                    teeTime: calculateTeeTime(CONFIG.startTime, index, CONFIG.interval),
                    players: members,
                    totalHDC: totalHDC
                });
            });

            localStorage.setItem(CONFIG.storageKey, JSON.stringify(currentFlights));
            renderFlights();
        }

        // --- UTILS ---
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function calculateTeeTime(startStr, index, interval) {
            let [hours, minutes] = startStr.split(':').map(Number);
            let totalMinutes = hours * 60 + minutes + (index * interval);
            let h = Math.floor(totalMinutes / 60);
            let m = totalMinutes % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
        }

        function renderFlights() {
            const grid = document.getElementById('fly-grid');
            grid.innerHTML = '';

            currentFlights.forEach(fly => {
                let playersHtml = fly.players.map(p => `
                    <div class="flex items-center gap-3 py-2 border-b border-gray-100 last:border-0 hover:bg-slate-50 transition px-2 rounded-lg -mx-2">
                        <div class="relative">
                            <img src="${p.avatarUrl}" class="w-10 h-10 rounded-full bg-gray-100 border border-gray-200" onerror="this.src='https://ui-avatars.com/api/?name=${p.name}&background=random'">
                            <div class="absolute -bottom-1 -right-1 bg-green-500 w-3 h-3 rounded-full border-2 border-white"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-bold text-sm text-gray-800 truncate font-mono-tech" title="${p.name}">${p.name}</div>
                            <div class="text-[10px] text-gray-400 font-mono">VGA: ${p.vga}</div>
                        </div>
                        <div class="text-right">
                            <span class="badge-hdc px-2 py-0.5 rounded text-xs font-bold block w-[35px] text-center">${p.hdc}</span>
                        </div>
                    </div>
                `).join('');

                const card = document.createElement('div');
                card.className = "bg-white rounded-xl card-shadow card-hover overflow-hidden flex flex-col h-full border border-gray-100";
                card.innerHTML = `
                    <div class="bg-slate-50 px-4 py-3 border-b border-gray-100 flex justify-between items-center relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-1 h-full bg-green-500"></div>
                        <div class="flex items-center gap-2">
                            <div class="bg-white text-green-700 w-8 h-8 flex items-center justify-center rounded-lg font-bold text-sm shadow-sm border border-green-100">
                                ${fly.flyNo}
                            </div>
                            <span class="text-xs font-bold text-gray-400 uppercase tracking-widest font-mono-tech">FLIGHT</span>
                        </div>
                        <div class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-md text-sm font-bold font-mono border border-yellow-200 shadow-sm">
                            ${fly.teeTime}
                        </div>
                    </div>
                    <div class="p-4 flex-grow">
                        ${playersHtml}
                    </div>
                    <div class="bg-gray-50 p-2 text-center border-t border-gray-100 text-[10px] text-gray-400 font-mono">
                         TEAM HDC: ${fly.totalHDC}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function copyToClipboard() {
            let content = "FlyNo\tTeeTime\tPlayerName\tVGA\tHandicap\tGroupHDC\tAvatarURL\n";
            currentFlights.forEach(fly => {
                fly.players.forEach(p => {
                    content += `${fly.flyNo}\t${fly.teeTime}\t${p.name}\t${p.vga}\t${p.hdc}\t${fly.totalHDC}\t${p.avatarUrl}\n`;
                });
            });
            navigator.clipboard.writeText(content).then(() => {
                showToast("Đã copy dữ liệu! Hãy Paste (Ctrl+V) vào Google Sheet.");
            }).catch(err => {
                alert("Lỗi copy: " + err);
            });
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toast-msg');
            toastMsg.innerText = msg;
            toast.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10');
            }, 3000);
        }

        init();
    </script>
</body>
</html>
